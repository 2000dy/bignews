"use strict";(self["webpackChunkvue_event"]=self["webpackChunkvue_event"]||[]).push([[441],{2441:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("文章列表")])]),t("div",{staticClass:"search-box"},[t("el-form",{attrs:{inline:!0,model:e.q}},[t("el-form-item",{attrs:{label:"文章分类"}},[t("el-select",{attrs:{placeholder:"请选择分类",size:"small"},model:{value:e.q.cate_id,callback:function(t){e.$set(e.q,"cate_id",t)},expression:"q.cate_id"}},e._l(e.artCateList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.cate_name,value:e.id}})})),1)],1),t("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"发布状态"}},[t("el-select",{attrs:{placeholder:"请选择状态",size:"small"},model:{value:e.q.state,callback:function(t){e.$set(e.q,"state",t)},expression:"q.state"}},[t("el-option",{attrs:{label:"已发布",value:"已发布"}}),t("el-option",{attrs:{label:"草稿",value:"草稿"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.choseFn}},[e._v("筛选")]),t("el-button",{attrs:{type:"info",size:"small"},on:{click:e.resetFn}},[e._v("重置")])],1)],1),t("el-button",{staticClass:"btn-pub",attrs:{type:"primary",size:"small"},on:{click:e.pubArt}},[e._v("发表文章")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.artList,border:"",stripe:""}},[t("el-table-column",{attrs:{label:"文章标题",prop:"title"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.details(a.row.id)}}},[e._v(e._s(a.row.title))])]}}])}),t("el-table-column",{attrs:{label:"分类",prop:"cate_name"}}),t("el-table-column",{attrs:{label:"发表时间",prop:"pub_date"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.$formatDate(a.row.pub_date)))])]}}])}),t("el-table-column",{attrs:{label:"状态",prop:"state"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deleteArt(a.row.id)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.q.pagenum,"page-sizes":[2,3,,5,10],"page-size":e.q.pagesize,layout:"total,sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){return e.$set(e.q,"pagenum",t)},"update:current-page":function(t){return e.$set(e.q,"pagenum",t)},"update:pageSize":function(t){return e.$set(e.q,"pagesize",t)},"update:page-size":function(t){return e.$set(e.q,"pagesize",t)}}})],1),t("el-dialog",{attrs:{title:"发表文章",visible:e.pubDialogVisible,fullscreen:"","before-close":e.handleClose},on:{"update:visible":function(t){e.pubDialogVisible=t},close:e.dialogClose}},[t("el-form",{ref:"pubFormRef",attrs:{model:e.pubForm,rules:e.pubFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.pubForm.title,callback:function(t){e.$set(e.pubForm,"title",t)},expression:"pubForm.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"cate_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分类"},model:{value:e.pubForm.cate_id,callback:function(t){e.$set(e.pubForm,"cate_id",t)},expression:"pubForm.cate_id"}},e._l(e.artCateList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.cate_name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[t("quill-editor",{on:{blur:e.chageFN},model:{value:e.pubForm.content,callback:function(t){e.$set(e.pubForm,"content",t)},expression:"pubForm.content"}})],1),t("el-form-item",{attrs:{label:"文章封面",prop:"cover_img"}},[t("img",{ref:"imgRef",staticClass:"cover-img",attrs:{src:a(2921),alt:""},on:{click:e.imgclick}}),t("br"),t("input",{ref:"iptFileRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.changeCover}}),t("el-button",{attrs:{type:"text"},on:{click:e.selectCover}},[e._v("+ 选择封面")])],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.pubArticle("已发布")}}},[e._v("发布")]),t("el-button",{attrs:{type:"info"},on:{click:function(t){return e.pubArticle("草稿")}}},[e._v("存为草稿")])],1)],1)],1),t("el-dialog",{attrs:{visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-card",{staticClass:"detailscard"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{xs:12,lg:19,sm:15}},[t("div",{staticClass:"header_txt"},[t("h1",{staticClass:"title"},[e._v(e._s(e.detail.title))]),t("div",{staticClass:"articleInfo"},[t("span",[e._v("类别："+e._s(e.detail.cate_name))]),t("span",[e._v("发布人："+e._s(e.detail.nickname||e.detail.username))]),t("span",[e._v("发布于："+e._s(e.$formatDate(e.detail.pub_date)))])])])]),t("el-col",{attrs:{xs:6,lg:4,sm:4}},[t("div",{staticClass:"header_img"},[e.detail.cover_img?t("img",{attrs:{src:e.baseURL+e.detail.cover_img,alt:"",srcset:""}}):e._e()])])],1),t("el-divider"),t("div",{staticClass:"content"},[t("span",{domProps:{innerHTML:e._s(e.detail.content)}})])],1)],1)],1)},s=[],l=a(7877),r=a(2921),n=a(4471),o={name:"ArtList",data(){return{baseURL:n.v,q:{pagenum:1,pagesize:2,cate_id:"",state:""},imgObj:r,pubDialogVisible:!1,dialogVisible:!1,pubForm:{title:"",cate_id:"",content:"",cover_img:null,state:""},pubFormRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"文章标题的长度为1-30个字符",trigger:"blur"}],cate_id:[{required:!0,message:"请选择文章分类",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"change"}],cover_img:[{required:!0,message:"请选择文章封面",trigger:"change"}]},artCateList:[],artList:[],total:0,url:"",detail:[]}},methods:{async getArtCateList(){const{data:e}=await(0,l.Kp)();if(0!==e.code)return this.$message.error(e.message);this.artCateList=e.data},async getArticleFN(){const{data:e}=await(0,l.uT)(this.q);this.total=e.total,this.artList=e.data},async handleClose(e){const t=await this.$confirm("此操作会使未保存内容丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));"cancel"!==t&&e()},pubArt(){this.pubDialogVisible=!0},selectCover(){this.$refs.iptFileRef.click()},imgclick(){this.$refs.iptFileRef.click()},changeCover(e){const t=e.target.files;if(0===t.length)this.pubForm.cover_img=null,this.$refs.imgRef.setAttribute("src",r);else{this.pubForm.cover_img=t[0];const e=URL.createObjectURL(t[0]);this.$refs.imgRef.setAttribute("src",e)}this.$refs.pubFormRef.validateField("cover_img")},pubArticle(e){this.$refs.pubFormRef.validate((async t=>{if(!t)return!1;{this.pubForm.state=e,console.log(this.pubForm);const t=new FormData;t.append("title",this.pubForm.title),t.append("cate_id",this.pubForm.cate_id),t.append("content",this.pubForm.content),t.append("cover_img",this.pubForm.cover_img),t.append("state",this.pubForm.state);const{data:a}=await(0,l.Qq)(t);if(0!==a.code)return this.$message.error(a.message);this.$message.success(a.message),this.pubDialogVisible=!1,this.getArticleFN()}}))},chageFN(){this.$refs.pubFormRef.validateField("content")},dialogClose(){this.$refs.pubFormRef.resetFields(),this.$refs.imgRef.setAttribute("src",r)},handleSizeChange(e){this.q.pagesize=e,this.q.pagenum=1,this.getArticleFN()},handleCurrentChange(e){this.q.pagenum=e,this.getArticleFN()},choseFn(){this.q.pagenum=1,this.q.pagesize=2,this.getArticleFN()},resetFn(){this.q.pagenum=1,this.q.pagesize=2,this.q.cate_id="",this.q.state="",this.getArticleFN()},async details(e){this.dialogVisible=!0;const{data:t}=await(0,l.av)(e);this.detail=t.data},async deleteArt(e){const{data:t}=await(0,l._s)(e);if(0!==t.code)return this.$message.error(t.message);this.$message.success(t.message),console.log("删除文章",t),this.resetFn()}},mounted(){this.getArtCateList(),this.getArticleFN()}},c=o,u=a(1001),p=(0,u.Z)(c,i,s,!1,null,"020fde11",null),d=p.exports},2921:function(e,t,a){e.exports=a.p+"img/cover.54bfb07c.jpg"}}]);
//# sourceMappingURL=441.e8faee58.js.map